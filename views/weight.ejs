<!DOCTYPE html>
<html>
<head>
	<title>Line Chart</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.28.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.28.0/locale/af.min.js"></script>>
	<!-- <script async="" src="//www.google-analytics.com/analytics.js"></script> -->
	<!-- <script src="https:/charts.org/samples/latest/scales/time/utils.js"></script> -->
</head>
<!-- <body>
<canvas id="myChart"></canvas>
<form >
	<input type="text" name="date" placeholder="new date">
	<input type="text" name="figure" placeholder="new figure">
	<input type="submit">
</form>
<script type="text/javascript" src="chart.js"></script>
</body> -->
<body>
	<div style="width:75%;"><div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>
		<canvas id="myChart" style="display: block; height: 361px; width: 723px;" width="1446" height="722" class="chartjs-render-monitor"></canvas>
	</div>
	<p> <%= history %></p>
	<div>
		<form >
			<label for="date_1">Enter Date:
			<input type="date" name="date_1" required pattern = "\d{4}-\d{2}-\d{2}">
			<span class="validity"></span>
			</label>
			<label for="weight"> Body Weight: 
				<input type="number" name="weight">
			</label>
			<p><button>Submit</button></p>
		</form>
	</div>
<script type="text/javascript">
	let ctx = document.getElementById("myChart").getContext('2d');
	//the following is for testing
	let mytime = <%- JSON.stringify(history.records[0].date) %>;

//date taken from dbs
let weights = [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						// randomScalingFactor(),
						null,
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					];

//input a string of time, 
function getFigureForWeek(time){
	let dates = [];
	let figures = [];
	for(i=0; i>-7;i--)
		dates.unshift(moveDateL(time, i));
	let config = {
	type: 'line',
	data: {
					labels: dates,
		datasets: [{
					label: 'My First dataset',
					backgroundColor: "red",
					borderColor: "red",
					fill: false,
					data: weights,
				}]
	},
	options: {  
		        spanGaps: true,
				title: {
					text: 'Chart.js Time Scale'
				},
                scales:{
                	xAxes:[{
                		// type: 'time',
                		time:{
                			displayFormats: {
                				quarter: 'MMM YYYY'
                			}
                		}
                	}]
                }
			}
    };
	return config;
}
		var timeFormat = 'MMM D';

		function newDate(days) {
			return moment().add(days, 'd').format('MMM DD');
		}

		function moveDateL(day, dis){
			return moment(day, 'YYYY/MM/DD').add(dis, 'day').format('L');
		}

		function moveDateMD(day, dis){
			return moment(day, 'YYYY/MM/DD').add(dis, 'day').format('MMM DD');
		}

		function newDateString(days) {
			return moment().add(days, 'd').format(timeFormat);
		}

		function randomScalingFactor(){
			return getRandomInt(30);
		}

		function getRandomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }

function draw(time){
	var chart = new Chart(ctx, getFigureForWeek(time));
}

draw(mytime);
</script>
</body>
</html>